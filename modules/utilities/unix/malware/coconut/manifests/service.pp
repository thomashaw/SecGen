class coconut::service {
  # If we've got a port supplied, host the binary over the network. Otherwise do nothing
  $secgen_parameters = secgen_functions::get_parameters($::base64_inputs_file)
  $account = parsejson($secgen_parameters['account'][0])
  $username = $account['username']
  $run_sample = str2bool($secgen_parameters['run_sample'][0])

  if $run_sample {
    notice("COCONUT run_sample $run_sample: Running sample on reboot via cron... ")

    # run on each boot via cron
    cron { "cron run on reboot /home/${username}/malware/coconut":
      command => "sleep 60; /home/${$username}/malware/coconut",
      special => 'reboot',
    }
  } else {
    notice("COCONUT run_sample $run_sample: Not running sample... ")
  }
}